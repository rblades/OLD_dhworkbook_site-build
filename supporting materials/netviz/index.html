<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Shawn Graham">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Network visualization with igraph - HIST3814o Crafting Digital History</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Network visualization with igraph";
    var mkdocs_page_input_path = "supporting materials/netviz.md";
    var mkdocs_page_url = "/supporting materials/netviz/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> HIST3814o Crafting Digital History</a>
        <a href="#skip-nav">Skip navigation menu</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <label hidden for="search-box" aria-hidden="false">Search Documents
    </label>
    <input id="search-box" type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
  <ul class="current">
    
          
            <li class="toctree-l1">
    
    <a class="" href="../..">Home</a>
      </li>
          
            <li class="toctree-l1">
    
    <a class="" href="../../introduction/crafting-digital-history/">Getting Started</a>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">1. Open Access Research</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-1/Open-Access-Research/">Why you should be open</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-1/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">2. Finding Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-2/Finding Data/">How do we find data?</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-2/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">3. Fixing Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-3/Wrangling Data/">Data is messy</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-3/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">4. Analysis</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-4/Seeing Patterns/">Seeing Patterns</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-4/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">5. Visualization</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-5/Humanities Visualization/">Communicating your Findings</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-5/Exercises/">Exercises (OPTIONAL)</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <a class="" href="../../conclusion/conclusion/">6. Final Thoughts</a>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">Appendices</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tei/">Text Encoding Initiative</a>
                </li>
                <li class="">
                    
    <a class="" href="../git-rstudio/">Git in RStudio</a>
                </li>
                <li class="">
                    
    <a class="" href="../regex/">Introduction to Regular Expressions (regex)</a>
                </li>
                <li class="">
                    
    <a class="" href="../regexex/">Regex & the Republic of Texas</a>
                </li>
                <li class="">
                    
    <a class="" href="../open-refine/">Open Refine</a>
                </li>
                <li class="">
                    
    <a class="" href="../ner/">Stanford Named Entity Recognizer</a>
                </li>
                <li class="">
                    
    <a class="" href="../regex-ner/">Going further with regex</a>
                </li>
                <li class="">
                    
    <a class="" href="../quick-intro-r/">Quick intro to R</a>
                </li>
                <li class="">
                    
    <a class="" href="../cyoa.txt/">Choose Your Own Adventure</a>
                </li>
                <li class="">
                    
    <a class="" href="../geoparsing-w-python.txt/">Geoparsing with Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../glitch/">Glitch</a>
                </li>
                <li class="">
                    
    <a class="" href="../gephi.txt/">Social Network Analysis with Gephi</a>
                </li>
                <li class="">
                    
    <a class="" href="../multimode-networks.txt/">Multimode Networks</a>
                </li>
                <li class="">
                    
    <a class="" href="../graphing-the-net.txt/">Graphing the Net</a>
                </li>
                <li class="">
                    
    <a class="" href="../topicmodel-r-dhbox/">Topic Modeling, DH Box</a>
                </li>
                <li class="">
                    
    <a class="" href="../topicmodel-r-yourmachine/">Topic Modeling, Local</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Network visualization with igraph</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#using-igraph-to-visualize-network-data">Using igraph to visualize network data</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#installing-igraph">Installing igraph</a></li>
        
            <li><a class="toctree-l4" href="#getting-the-data-into-your-project">Getting the data into your project</a></li>
        
            <li><a class="toctree-l4" href="#visualization">Visualization</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../inkscape/">Inkscape</a>
                </li>
                <li class="">
                    
    <a class="" href="../gh-pages/">GitHub Pages</a>
                </li>
                <li class="">
                    
    <a class="" href="../leaflet.txt/">Leaflet</a>
                </li>
    </ul>
      </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">HIST3814o Crafting Digital History</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Appendices &raquo;</li>
        
      
    
    <li>Network visualization with igraph</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages/edit/master/docs/supporting materials/netviz.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <a name="skip-nav" aria-label="Anchor link destination for skipping navigation"></a>
          <div role="main">
            <div class="section">
              
                <h1 id="using-igraph-to-visualize-network-data">Using igraph to visualize network data</h1>
<p>In this exercise, we are doing a quick first pass on the network data generated from the Republic of Texas correspondence. I am providing you with the <strong>edge list</strong>, the links of to &mdash; from that we generated earlier. I am also providing you the <strong>node list</strong>, the list of individuals extracted from that edge list. If we keep our nodes and edges separated in CSV tables, we can add other <strong>attributes</strong> later (things like date, or number of times a pair of individuals corresponded; ie. weight, or gender, or location, or what have you) to create different views or analyses. I used Open Refine to clean this data up for you (recall our <a href="../open-refine/">lesson on Open Refine</a>). Remember, 80 percent of all digital history work involves cleaning data!</p>
<p>Below is the data that you need; download both files and use the File Manager to load them into your DH Box into your new R project for this tutorial.</p>
<ul>
<li><a href="../../supporting materials/texaslinks.csv">List of links (this downloads a CSV file)</a></li>
<li><a href="../../supporting materials/texasnodes.csv">List of nodes(this downloads a CSV file)</a></li>
</ul>
<p>This tutorial will illustrate to you some of the ways the igraph package can be used to create quick visualizations or to generate network statistics. These of course on their own mean very little: this is where your historical sensibility comes into play, triangulating this generated data with other things you know about the historical context of the time, place and players!</p>
<p>Remember to make a new project in RStudio by clicking the down arrow on the R button at the right side of the RStudio interface; start the project in a new folder. Then using the DH Box File Manager, upload the nodes and links data from your computer to that folder you just created.</p>
<h2 id="installing-igraph">Installing igraph</h2>
<p>Once that's accomplished, go back into RStudio and start a new script:</p>
<pre><code class="R"># install igraph; this might take a long time
# you only run this line the first time you install igraph:
install.packages('igraph')

# a lot of stuff gets downloaded and installed.

# now tell RStudio you want to use the igraph pacakge and its functions:
library('igraph')
</code></pre>

<p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/xDArmsNYf1g?rel=0" title="Preparing your data for RStudio" frameborder="0" gesture="media" allowfullscreen></iframe>
<br></p>
<h2 id="getting-the-data-into-your-project">Getting the data into your project</h2>
<p>For future reference, we're adapting our script from a more in-depth <a href="http://kateto.net/networks-r-igraph">tutorial of R igraph</a>.</p>
<ol>
<li>
<p>Bringing data into R is straightforward. We create a variable for <code>nodes</code> and a variable for <code>links</code> and load the data from our CSV files into them like the following:</p>
<pre><code># now let's load up the data by putting the csv files into nodes and links.
nodes &lt;- read.csv("texasnodes.csv", header=T, as.is=T)
links &lt;- read.csv("texaslinks.csv", header=T, as.is=T)
</code></pre>
</li>
<li>
<p>We can examine the start or end of a variable with the head or tail command; these look at the first few lines at the start (<code>head</code>) or end (<code>tail</code>) of the variable, like the following:</p>
<pre><code>#examine data
head(nodes)
head(links)

nrow(nodes); length(unique(nodes$id))
# which gives the number of nodes in our data

nrow(links); nrow(unique(links[,c("source", "target")]))
# which gives the number of sources, and number of targets
# which means some people sent more than one letter, and some people received more than one letter
</code></pre>
</li>
<li>
<p>Let's rearrange things so that instead of the following:</p>
<pre><code>Alice -&gt; Bob, 1 letter
Alice -&gt; Bob, 1 letter
Alice -&gt; Bob, 1 letter
</code></pre>
<p>we have the following:</p>
<pre><code>Alice -&gt; Bob, 3 letters
</code></pre>
<p>That is, we're going to count up the number of times a particular relationship exists, and assign that count to the weight column. Much tidier all around! </p>
</li>
<li>
<p>We do that like the following:</p>
<pre><code>links &lt;- aggregate(links[,3], links[,-3], sum)

links &lt;- links[order(links$target, links$source),]

colnames(links)[3] &lt;- "weight"

rownames(links) &lt;- NULL

head(links)
</code></pre>
<p>You should see the following:</p>
<pre><code>           source            target weight
1      James Webb       Abb6 Anduz6      1
2   A. de Saligny Abner S. Lipscomb      1
3     E. W. Moore Abner S. Lipscomb      1
4  James Hamilton Abner S. Lipscomb     14
5     James Treat Abner S. Lipscomb     11
6 Nathaniel Amory Abner S. Lipscomb      1
</code></pre>
</li>
<li>
<p>Now, let's tell R to stitch our links together into a network object (a data frame) that it can visualize and analyze, like the following:</p>
<pre><code># let's make a net
# notice that we are telling igraph that the network is directed, that the relationship Alice to Bob is different than Bob's to Alice (Alice is the _sender_, and Bob is the _receiver_)

# In older DH Box version of igraph in RStudio: 
net &lt;- graph.data.frame(d=links, vertices=nodes, directed=T)

# OR Newer version of igraph in desktop RStudio:
net &lt;- graph_from_data_frame(d=links, vertices=nodes, directed=T)

# type 'net' again and run the line to see how the network is represented.
net

# let's visualizae it
plot(net, edge.arrow.size=.4,vertex.label=NA)

# two quite distinct groupings, it would appear.
</code></pre>
<p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pcZwwZDEoN4?rel=0" title="Getting data into your project" frameborder="0" gesture="media" allowfullscreen></iframe>
<br></p>
<p>Before we jump down the rabbit hole of visualization, let's recognize right now that <strong>visualizing</strong> a network is only rarely of analytical value. The value of network analysis comes from the various questions we can now start posing of our data when it is represented as a network. In this correspondence network, who is in the centre of the web? To whom would information flow? To whom would information leak? Are there cliques or ingroups? When we identify such individuals, how does that confirm or confound our expectations of the period and place?</p>
<p>Many different kinds of metrics can be calculated (and <a href="http://kateto.net/networks-r-igraph">the Kateto R igraph tutorial will show you how</a>) but it's always worth remembering that a metric is only meaningful for a given network when we're dealing with similar things &mdash; a network of people who write letters to one another; a network of banks that swap mortgages with one another. These are called 'one mode networks'. A network of people connected to the banks they use &mdash; a two mode network, because it connects two different kinds of things &mdash; might be useful to <strong>visualize</strong> but the metrics calculated might not be <strong>valid</strong> if the metric was designed to work on a one-mode network (for more on this and allied issues, visit <a href="http://www.scottbot.net/HIAL/index.html@p=6279.html">Scott Weingart's Demystifying Networks</a>).</p>
</li>
<li>
<p>Given our correspondence network, let's imagine that 'closeness' (a measure of how central a person is) and 'betweenness' (a measure of how many different strands of the network pass through this person) are the most historically interesting. Further, we're going to try to determine if there are subgroups in our network, cliques.</p>
<pre><code>## the 'degree' of a node is the count of its connections. In this code chunk, we calculate degree, then make both a histogram of the counts and a plot of the network where we size the nodes proportionately to their degree. What do we learn from these two visualizations?
deg &lt;- degree(net, mode="all")
hist(deg, breaks=1:vcount(net)-1, main="Histogram of node degree")
plot(net, vertex.size=deg*2, vertex.label = NA)
## write this info to file for safekeeping
write.csv(deg, 'degree.csv')
</code></pre>
</li>
<li>
<p>Now we'll look at closeness. If you know the width or <strong>diameter</strong> of your network (the maximum number of steps to get across it), then the node that is on average the shortest number of steps from all the others is the one that is closest. We calculate it like the following:</p>
<pre><code>closepeople &lt;- closeness(net, mode="all", weights=NA)
sort(closepeople, decreasing = T) # so that we see who is most close first
write.csv(closepeople, 'closeness.csv') # so we have it on file.
</code></pre>
</li>
<li>
<p>We can ask which individuals are hubs, and which are authorities. In the lingo, 'hubs' are individuals with many outgoing links (they <strong>sent</strong> lots of letters) while 'authorities' are individuals who <strong>received</strong> lots of letters. In the code below, can you work out what command to give to write the hub score or the authority scores to a file?</p>
<pre><code># In older DH Box version of igraph in RStudio: 
hs &lt;- hub.score(net, weights=NA)$vector
as &lt;- authority.score(net, weights=NA)$vector

# OR Newer version of igraph in desktop RStudio:
hs &lt;- hub_score(net, weights=NA)$vector
as &lt;- authority_score(net, weights=NA)$vector

par(mfrow=c(1,2))

# vertex.label.cex sets the size of the label; play with the sizes until you see something appealing.
plot(net, vertex.size=hs*40, vertex.label.cex =.2, edge.arrow.size=.1, main="Hubs")
plot(net, vertex.size=as*20, vertex.label = NA, edge.arrow.size=.1, main="Authorities")
</code></pre>
</li>
<li>
<p>Let's look for 'modules' within this network. Broadly speaking, these are clumps of nodes that have more or less the same pattern of ties between them, <strong>within</strong> the group, than without.</p>
<pre><code># In older DH Box version of igraph in RStudio: 
cfg &lt;- fastgreedy.community(as.undirected(net))

# OR Newer version of igraph in desktop RStudio:
cfg &lt;- cluster_fast_greedy(as.undirected(net))

lapply(cfg, function(x) write.table( data.frame(x), 'cfg.csv'  , append= T, sep=',' ))
</code></pre>
<p>We create a new variable called <code>cfg</code> and get the <code>cluster_fast_greedy</code> algorithm to perform its calculations. The next line writes the groups to a file, separating each group with an <code>x</code>. (If you tried <code>write.csv</code> as before, you'll get an error message because the output of the algorithm gives a different kind of data type. R is fussy like this.) Examine that file &mdash; what groups do you spot? What might these mean, if you went back to the content of the original letters?</p>
<p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/2-rH88PU3vw?rel=0" title="Measuring closeness in our network" frameborder="0" gesture="media" allowfullscreen></iframe>
<br></p>
</li>
</ol>
<h2 id="visualization">Visualization</h2>
<ol>
<li>
<p>The line below will plot out our network, colouring it by the communities discerned above, like the following:</p>
<pre><code>plot(cfg, net, vertex.size = 1, vertex.label.cex =.2, edge.arrow.size=.1, main="Communities")
</code></pre>
</li>
<li>
<p>You can export the plot by clicking on the 'Export' button in the plot panel, to PDF or to PNG. But this is a pretty ugly network. We need to apply a <strong>layout</strong> to try to make it more visually understandable. There are many different layout options in igraph. We'll assign the layout we want to a variable, and then we'll give that variable to the <code>plot</code> command like the following:</p>
<pre><code># In older DH Box version of igraph in RStudio:
l1 &lt;- layout.fruchterman.reingold(net)

# OR Newer version of igraph in desktop RStudio:
l1 &lt;- layout_with_fr(net)

plot(cfg, net, layout=l1, vertex.size = 1, vertex.label.cex =.2, edge.arrow.size=.1, main="Communities")
</code></pre>
<p>The <code>layout_with_fr</code> is calling the 'Fruchterman-Reingold' algorithm, a kind of layout that imagines each node as a repulsive power, pushing against all the other nodes (it's part of a family of layouts called 'Forced Atlas'). That also means that if you ran the plot command a couple of times, the nodes might end up in different places each time &mdash; they are jostling for relative position, and this positioning itself carries no meaning in and of itself (so if a node is at the top of the screen, or the centre of the screen, don't read that to mean anything about importance).</p>
</li>
<li>
<p>Good luck! Remember to save your script, and upload the entire project folder to your GitHub repository.</p>
<p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/j2KOE-gTqkg?rel=0" title="Visualizing our network" frameborder="0" gesture="media" allowfullscreen></iframe>
<br></p>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../inkscape/" class="btn btn-neutral float-right" title="Inkscape"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../topicmodel-r-yourmachine/" class="btn btn-neutral" title="Topic Modeling, Local"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

The Crafting Digital History site is built with <a href="http://www.mkdocs.org">MkDocs</a> using a theme provided by <a href="https://readthedocs.org">Read the Docs</a>. All documents are available on <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages"> GitHub</a>. I thank Reclaim Hosting for their help, support, and example in getting this site up and running.
</footer>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
<script>
  $(document).ready(function(){
    // Target your .container, .wrapper, .post, etc.
    $(".section").fitVids();
  });
</script>
    
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../topicmodel-r-yourmachine/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../inkscape/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
