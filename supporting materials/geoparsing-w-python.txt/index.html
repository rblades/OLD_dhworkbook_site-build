<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Shawn Graham">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Geoparsing with Python - HIST3814o Crafting Digital History</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Geoparsing with Python";
    var mkdocs_page_input_path = "supporting materials/geoparsing-w-python.txt.md";
    var mkdocs_page_url = "/supporting materials/geoparsing-w-python.txt/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> HIST3814o Crafting Digital History</a>
        <a href="#skip-nav">Skip navigation menu</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <label hidden for="search-box" aria-hidden="false">Search Documents
    </label>
    <input id="search-box" type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
  <ul class="current">
    
          
            <li class="toctree-l1">
    
    <a class="" href="../..">Home</a>
      </li>
          
            <li class="toctree-l1">
    
    <a class="" href="../../introduction/crafting-digital-history/">Getting Started</a>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">1. Open Access Research</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-1/Open-Access-Research/">Why you should be open</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-1/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">2. Finding Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-2/Finding Data/">How do we find data?</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-2/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">3. Fixing Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-3/Wrangling Data/">Data is messy</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-3/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">4. Analysis</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-4/Seeing Patterns/">Seeing Patterns</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-4/Exercises/">Exercises</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">5. Visualization</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../module-5/Humanities Visualization/">Communicating your Findings</a>
                </li>
                <li class="">
                    
    <a class="" href="../../module-5/Exercises/">Exercises (OPTIONAL)</a>
                </li>
    </ul>
      </li>
          
            <li class="toctree-l1">
    
    <a class="" href="../../conclusion/conclusion/">6. Final Thoughts</a>
      </li>
          
            <li class="toctree-l1">
    
    <span class="caption-text">Appendices</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tei/">Text Encoding Initiative</a>
                </li>
                <li class="">
                    
    <a class="" href="../git-rstudio/">Git in RStudio</a>
                </li>
                <li class="">
                    
    <a class="" href="../regex/">Introduction to Regular Expressions (regex)</a>
                </li>
                <li class="">
                    
    <a class="" href="../regexex/">Regex & the Republic of Texas</a>
                </li>
                <li class="">
                    
    <a class="" href="../open-refine/">Open Refine</a>
                </li>
                <li class="">
                    
    <a class="" href="../ner/">Stanford Named Entity Recognizer</a>
                </li>
                <li class="">
                    
    <a class="" href="../regex-ner/">Going further with regex</a>
                </li>
                <li class="">
                    
    <a class="" href="../quick-intro-r/">Quick intro to R</a>
                </li>
                <li class="">
                    
    <a class="" href="../cyoa.txt/">Choose Your Own Adventure</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Geoparsing with Python</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#geoparsing-with-python">Geoparsing with Python</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../glitch/">Glitch</a>
                </li>
                <li class="">
                    
    <a class="" href="../gephi.txt/">Social Network Analysis with Gephi</a>
                </li>
                <li class="">
                    
    <a class="" href="../multimode-networks.txt/">Multimode Networks</a>
                </li>
                <li class="">
                    
    <a class="" href="../graphing-the-net.txt/">Graphing the Net</a>
                </li>
                <li class="">
                    
    <a class="" href="../topicmodel-r-dhbox/">Topic Modeling, DH Box</a>
                </li>
                <li class="">
                    
    <a class="" href="../topicmodel-r-yourmachine/">Topic Modeling, Local</a>
                </li>
                <li class="">
                    
    <a class="" href="../netviz/">Network visualization with igraph</a>
                </li>
                <li class="">
                    
    <a class="" href="../inkscape/">Inkscape</a>
                </li>
                <li class="">
                    
    <a class="" href="../gh-pages/">GitHub Pages</a>
                </li>
                <li class="">
                    
    <a class="" href="../leaflet.txt/">Leaflet</a>
                </li>
    </ul>
      </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">HIST3814o Crafting Digital History</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Appendices &raquo;</li>
        
      
    
    <li>Geoparsing with Python</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages/edit/master/docs/supporting materials/geoparsing-w-python.txt.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <a name="skip-nav" aria-label="Anchor link destination for skipping navigation"></a>
          <div role="main">
            <div class="section">
              
                <h1 id="geoparsing-with-python">Geoparsing with Python</h1>
<p>This exercise draws from the work of <a href="http://fredgibbs.net/">Fred Gibbs</a>.</p>
<ul>
<li><a href="http://fredgibbs.net/tutorials/extract-transform-save-csv.html">Extract, transform, and save as CSV</a></li>
<li><a href="http://fredgibbs.net/tutorials/extract-geocode-placenames-from-text-file.html">Extract geocoded placenames from a text file</a></li>
<li><a href="http://fredgibbs.net/tutorials/create-kml-file-python.html">Create a KML file with Python</a></li>
</ul>
<p>In this exercise, you will need to have Python installed on your machine. <a href="https://www.python.org/downloads/">You can download it from Python's website</a>. I have version 2.7.9 on this machine, and know that what follows works with that version.</p>
<p><strong>NB</strong> Mac comes presinstalled with Python. There is no need to install it again.</p>
<p>You should also read and understand Fred Gibbs' tutorial on <a href="http://fredgibbs.net/tutorials/install-python-modules">installing Python modules</a> because you will need to install some helper modules.</p>
<p>In Module 3, you used the NER to extract place names from a text. After some further munging with regex, you might have ended up with a CSV that looks like <a href="https://raw.githubusercontent.com/hist3907b-winter2015/module4-holes/master/texas.csv">this one on my GitHub</a>.</p>
<ol>
<li>Use Open Refine to open that CSV file. In the same way you tidied up in the <a href="../../supporting materials/open-refine/">Open Refine tutorial in Module 3</a>, clean up this CSV so that you merge together place names appropriately (ie. so that '4ustin' gets merged with 'Austin'). Do this for all the columns.</li>
<li>Export the table as a new CSV &mdash; call it <code>cleaned-places.csv</code>.</li>
<li>Open that CSV in your spreadsheet program. Copy and paste all of the columns so that they become a single list (ie. one column of place names).</li>
<li>Using your spreadsheet's filtering options, see if you can remove any more duplicates. (It might be useful to keep track of how many duplicates you delete, in a new file, eg. <code>Texas,200</code> that kind of information might be handy, as in <a href="http://mappingtexts.stanford.edu/whitepaper/MappingTexts_WhitePaper.pdf">the mapping texts project (PDF downloads in new tab)</a>).</li>
<li>Save the file you were removing the duplicates from (which has just a single column of unique place names) as <code>placelist.txt</code>.</li>
<li>Now, at this point, we're going to open up our text editor and create a new Python program, following <a href="http://fredgibbs.net/tutorials/extract-geocode-placenames-from-text-file.html">Gibbs' tutorial</a>. His complete script is at the bottom of his post, but make sure you understand everything that is going on. Do you see the places where he has to import new Python modules to make his script work? Make sure you've installed those modules. Let's call your completed script <code>geoparse.py</code>. Done that? Good. </li>
<li>Open your terminal, navigate to the folder you're working in, and run your script by typing the following:<pre><code>$ python geoparse.py
</code></pre>
</li>
</ol>
<p>Did it work? Did you get an error message? It's entirely possible that you got this message:</p>
<pre><code class="SHELL">Traceback (most recent call last):
  File &quot;geolocate.py&quot;, line 14, in &lt;module&gt;
    lat = json['results'][0]['geometry']['location']['lat']
IndexError: list index out of range
</code></pre>

<p>...but check your folder. Do you have a <code>geocoded-places.txt</code> file? If so, it worked! Or at least, it got most of your places from the Google maps API. (For the rest, you can try uploading your places list to <a href="https://www.ltg.ed.ac.uk/software/geoparser/">Scargill's geoparser</a> and then copying and pasting the output to an Excel file. This parser will give you several columns of results, where the first column represents its best guess and the other columns other possibilities).</p>
<p>You can now import your geocoded places into many other software packages. Gibbs also shows us how to convert our list into KML, the format that Google Earth and Google Maps can read. Try out <a href="http://fredgibbs.net/tutorials/create-kml-file-python.html">Gibbs' tutorial on creating KML files</a>. You can double-click on the resulting KML file, and if you have Google Earth installed, it will open up there. Within Google Earth, you can start adding more information, other annotations... pretty soon, you'll have a complete map!</p>
<p><strong>Remember to upload your scripts, data, and obersvations to your open notebook.</strong></p>
<p>(Incidentally, if you wanted to load this material into <a href="http://hdlab.stanford.edu/palladio/">Palladio</a> you'd need a file that looked like this the following.</p>
<pre><code>    Place   Coordinates
    MEXICO  23.634501,-102.552784
    California  36.778261,-119.4179324
    Brazos  32.661389,-98.121667
</code></pre>
<p>etc. That is, a tab between 'Place' and 'Coordinates' in the first line, a tab between 'Mexico' and the latitude, and a comma between latitude and logitude. Best way to effect this transformation? Probably using regex. (It's unfortunate that Palladio doesn't accept straightforward place, latitude, longitude comma separated data.)</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../glitch/" class="btn btn-neutral float-right" title="Glitch"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../cyoa.txt/" class="btn btn-neutral" title="Choose Your Own Adventure"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

The Crafting Digital History site is built with <a href="http://www.mkdocs.org">MkDocs</a> using a theme provided by <a href="https://readthedocs.org">Read the Docs</a>. All documents are available on <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages"> GitHub</a>. I thank Reclaim Hosting for their help, support, and example in getting this site up and running.
</footer>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
<script>
  $(document).ready(function(){
    // Target your .container, .wrapper, .post, etc.
    $(".section").fitVids();
  });
</script>
    
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/shawngraham/dhworkbook/tree/gh-pages" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../cyoa.txt/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../glitch/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
